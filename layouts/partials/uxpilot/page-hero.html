{{ $page := . }}
{{ if not $page.IsHome }}
  {{/* Determine hero content */}}
  {{ $title := $page.Title }}
  {{ $subtitle := or ($page.Params.subtitle) ($page.Params.Subtitle) ($page.Params.description) ($page.Params.Description) }}
  {{ $icon := or ($page.Params.hero_icon) ($page.Params.heroIcon) ($page.Params.heroicon) }}

  {{/* Build breadcrumb slice */}}
  {{ $crumbs := slice (dict "title" "Home" "url" site.Home.RelPermalink) }}
  {{ with $page.File }}
    {{ $path := .Path }}
    {{ $dir := path.Dir $path }}
    {{ if ne $dir "." }}
      {{ $segments := split $dir "/" }}
      {{ if and (ge (len $segments) 1) (eq (index $segments 0) "page") }}
        {{ $segments = after 1 $segments }}
      {{ end }}
      {{ $built := slice }}
      {{ range $segments }}
        {{ $built = $built | append . }}
        {{ $contentPath := printf "page/%s" (delimit $built "/") }}
        {{ $p := site.GetPage $contentPath }}
        {{ if not $p }}
          {{ $contentPath = printf "page/%s/_index" (delimit $built "/") }}
          {{ $p = site.GetPage $contentPath }}
        {{ end }}
        {{ $name := humanize (replaceRE "\\.md$" "" .) }}
        {{ if $p }}
          {{ $name = $p.Title }}
        {{ end }}
        {{ if $p }}
          {{ $crumbs = $crumbs | append (dict "title" $name "url" $p.RelPermalink) }}
        {{ else }}
          {{ $crumbs = $crumbs | append (dict "title" $name) }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
  {{ $crumbCount := len $crumbs }}
  {{ if gt $crumbCount 0 }}
    {{ $last := index $crumbs (sub $crumbCount 1) }}
    {{ if and (isset $last "url") (eq (index $last "url") $page.RelPermalink) }}
      {{ $adjusted := slice }}
      {{ range $i, $crumb := $crumbs }}
        {{ if eq $i (sub $crumbCount 1) }}
          {{ $adjusted = $adjusted | append (dict "title" (index $crumb "title")) }}
        {{ else }}
          {{ $adjusted = $adjusted | append $crumb }}
        {{ end }}
      {{ end }}
      {{ $crumbs = $adjusted }}
    {{ else }}
      {{ $crumbs = $crumbs | append (dict "title" $title) }}
      {{ $crumbCount = len $crumbs }}
    {{ end }}
  {{ else }}
    {{ $crumbs = slice (dict "title" $title) }}
    {{ $crumbCount = len $crumbs }}
  {{ end }}
  <section class="relative bg-gradient-to-br from-gray-50 to-white py-16 lg:py-24 overflow-hidden min-h-[320px] flex items-center">
    <div class="absolute inset-0">
      <div class="absolute top-10 left-0 w-72 h-72 bg-hologram-primary/20 rounded-full blur-3xl opacity-40"></div>
      <div class="absolute bottom-10 right-0 w-96 h-96 bg-hologram-secondary/20 rounded-full blur-3xl opacity-30"></div>
    </div>
    <div class="container mx-auto px-6 relative z-10">
      <div class="max-w-4xl mx-auto">
        <nav class="flex flex-wrap items-center gap-2 text-sm text-gray-500 mb-8" aria-label="Breadcrumb">
          {{ range $i, $crumb := $crumbs }}
            {{ if gt $i 0 }}
              <i class="fa-solid fa-chevron-right text-xs"></i>
            {{ end }}
            {{ with index $crumb "url" }}
              <a class="hover:text-hologram-primary transition-colors duration-200" href="{{ . }}">{{ index $crumb "title" }}</a>
            {{ else }}
              <span class="{{ if eq $i (sub (len $crumbs) 1) }}text-hologram-primary{{ else }}text-gray-600{{ end }}">{{ index $crumb "title" }}</span>
            {{ end }}
          {{ end }}
        </nav>
        <h1 class="text-4xl lg:text-6xl font-bold mb-6 leading-snug flex items-baseline flex-wrap gap-4 pb-2">
          {{ if $icon }}
            <i class="{{ $icon }} text-verana"></i>
          {{ end }}
          <span class="block py-1 pb-2 bg-gradient-to-r from-hologram-dark via-hologram-secondary to-hologram-primary bg-clip-text text-transparent drop-shadow-lg">{{ $title }}</span>
        </h1>
        {{ with $subtitle }}
          <p class="text-xl lg:text-2xl text-gray-600 max-w-3xl leading-relaxed">{{ . }}</p>
        {{ end }}
      </div>
    </div>
  </section>
{{ end }}
