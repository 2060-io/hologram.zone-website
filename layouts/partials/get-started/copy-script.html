{{- $page := .page -}}
{{- if not ($page.Scratch.Get "get_started_copy_script_included") -}}
  {{- $page.Scratch.Set "get_started_copy_script_included" true -}}
  <script id="get-started-copy-script">
    (function () {
      if (window.__getStartedCopyInit) return;
      window.__getStartedCopyInit = true;

      const bindCopyButtons = () => {
        const buttons = document.querySelectorAll('[data-copy-button]');
        buttons.forEach((button) => {
          if (button.dataset.copyBound === 'true') return;
          button.dataset.copyBound = 'true';

          button.addEventListener('click', async () => {
            const targetSelector = button.getAttribute('data-copy-target');
            const target = targetSelector ? document.querySelector(targetSelector) : null;
            if (!target) return;

            const text = target.textContent || target.value || '';
            if (!text) return;

            const copy = async () => {
              if (navigator.clipboard && navigator.clipboard.writeText) {
                await navigator.clipboard.writeText(text);
                return true;
              }
              const textarea = document.createElement('textarea');
              textarea.value = text;
              textarea.style.position = 'fixed';
              textarea.style.top = '-1000px';
              document.body.appendChild(textarea);
              textarea.focus();
              textarea.select();
              try {
                const result = document.execCommand('copy');
                document.body.removeChild(textarea);
                return result;
              } catch (err) {
                document.body.removeChild(textarea);
                return false;
              }
            };

            const originalLabel = button.dataset.copyOriginalLabel || button.innerHTML;
            try {
              const success = await copy();
              if (success) {
                button.dataset.copyOriginalLabel = originalLabel;
                button.classList.add('copied');
                const labelNode = button.querySelector('[data-copy-label]');
                if (labelNode) {
                  labelNode.dataset.copyOriginalText = labelNode.textContent;
                  labelNode.textContent = 'Copied';
                } else {
                  button.innerHTML = '<i class="fas fa-check mr-2"></i>Copied';
                }
                setTimeout(() => {
                  button.classList.remove('copied');
                  if (labelNode && labelNode.dataset.copyOriginalText) {
                    labelNode.textContent = labelNode.dataset.copyOriginalText;
                  } else if (button.dataset.copyOriginalLabel) {
                    button.innerHTML = button.dataset.copyOriginalLabel;
                  }
                }, 1600);
              }
            } catch (err) {
              console.warn('Copy failed', err);
            }
          });
        });
      };

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', bindCopyButtons, { once: true });
      } else {
        bindCopyButtons();
      }
    })();
  </script>
{{- end -}}
